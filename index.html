<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Market Overview</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: linear-gradient(135deg,#0f1419 0%,#1a1f2e 100%);
    --surface: rgba(23,26,33,.88);
    --surface-hover: rgba(30,35,45,.95);
    --border: rgba(56,68,77,.30);
    --border-hover: rgba(56,68,77,.55);
    --text: #e6e8eb;
    --muted: #9aa0a6;
    --accent: #4aa8ff;
    --accent2:#8b5cf6;
    --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --shadow2: 0 14px 44px rgba(0,0,0,.45);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg: linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);
      --surface: rgba(255,255,255,.96);
      --surface-hover:#fff;
      --border: rgba(203,213,225,.9);
      --border-hover: rgba(148,163,184,.7);
      --text:#1e293b; --muted:#64748b;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --shadow2: 0 14px 44px rgba(15,23,42,.12);
    }
  }
  html[data-theme="light"]{ /* نفس قيم اللايت */ }
  html[data-theme="dark"]{ /* نفس قيم الدارك */ }

  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    min-height:100vh;
  }
  .wrap{max-width:1400px;margin:0 auto;padding:20px}
  .brand{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:20px 0;border-bottom:1px solid var(--border)}
  h1{margin:0;font-size:clamp(22px,4vw,30px);font-weight:800;letter-spacing:-.02em;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn,.pill{
    background:var(--surface);border:1px solid var(--border);color:var(--text);
    border-radius:12px;padding:10px 14px;font:600 13px/1 'Inter',sans-serif;cursor:pointer;
    box-shadow:var(--shadow);transition:all .25s ease
  }
  .btn:hover,.pill:hover{background:var(--surface-hover);border-color:var(--border-hover);transform:translateY(-1px);box-shadow:var(--shadow2)}
  .me{color:var(--warn);border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.09)}
  .grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));align-items:stretch}
  .card{
    position:relative;background:var(--surface);border:1px solid var(--border);border-radius:18px;
    padding:18px;min-height:180px;display:flex;flex-direction:column;box-shadow:var(--shadow);transition:all .25s ease;overflow:hidden
  }
  .card:hover{transform:translateY(-2px);border-color:var(--border-hover);box-shadow:var(--shadow2)}
  .card::before{content:"";position:absolute;left:0;right:0;top:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2));opacity:.6}
  .card h3{margin:0 0 8px;font:700 15px/1.2 'Inter',sans-serif;letter-spacing:.2px}
  .muted{color:var(--muted);font-weight:600;font-size:12px}
  .big{
    font-weight:800;letter-spacing:-.02em;
    font-size:clamp(18px,3.6vw,28px);
    background:linear-gradient(180deg,var(--text) 0%,var(--accent) 120%);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent
  }
  /* الرقم في منتصف البطاقة */
  .centerBox{
    flex:1; display:grid; place-items:center; padding:4px 6px;
  }
  .kv{display:flex;justify-content:space-between;gap:10px;margin:6px 0}
  .kv span:first-child{color:var(--muted);font-size:12px;font-weight:600}
  .ok{background:rgba(16,185,129,.06);border-color:rgba(16,185,129,.45)}
  .warn{background:rgba(245,158,11,.06);border-color:rgba(245,158,11,.45)}
  .bad{background:rgba(239,68,68,.06);border-color:rgba(239,68,68,.45)}
  /* Chart */
  .chartWrap{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:18px;margin:16px 0 24px;box-shadow:var(--shadow)}
  .toolbar{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding-bottom:10px;margin-bottom:12px}
  canvas#priceChart{width:100%;height:340px;border-radius:10px;display:block}
  .gauge{width:100%;max-width:280px;margin:auto;filter:drop-shadow(0 4px 8px rgba(0,0,0,.08))}
  @media (max-width:768px){
    .wrap{padding:14px}
    .grid{grid-template-columns:1fr}
    .card{min-height:160px}
    canvas#priceChart{height:300px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="brand">
    <h1>Market Overview</h1>
    <div class="row">
      <div class="pill" id="marketScore">Market Score: loading…</div>
      <button class="btn" id="toggleChartBtn">Hide chart</button>
      <button class="btn" id="refreshBtn">Refresh</button>
      <button class="btn" id="themeBtn" title="Toggle theme">Theme: Auto</button>
      <div class="pill me">Made by Anas Alwadi</div>
    </div>
  </div>

  <div class="chartWrap" id="chartBox">
    <div class="toolbar">
      <div class="muted">BTC/USDT — last 180 days</div>
      <div class="muted" id="asofChart">Updating…</div>
    </div>
    <canvas id="priceChart" width="1080" height="340" aria-label="BTC price"></canvas>
  </div>

  <div class="grid" id="grid"></div>
  <p class="muted" id="asof" style="margin-top:8px"></p>
</div>

<script>
const $ = s => document.querySelector(s);
const bust = url => url + (url.includes("?")?"&":"?") + "t=" + Date.now();

/* تنسيق مختصر للأرقام الكبيرة */
function compact(n, withSymbol){
  if(n==null || !isFinite(n)) return "—";
  const abs = Math.abs(n);
  const units = [
    {v:1e12, s:"T"}, {v:1e9, s:"B"}, {v:1e6, s:"M"}, {v:1e3, s:"K"}
  ];
  for(const u of units){
    if(abs >= u.v) return (n/u.v).toFixed(2).replace(/\.0+$/,"") + (withSymbol?(" "+u.s):u.s);
  }
  return n.toLocaleString();
}
const pct = x => (x==null||!isFinite(x)) ? "—" : (x*100).toFixed(2)+"%";

/* Theme toggle: auto / light / dark */
function setTheme(mode){
  const html=document.documentElement;
  if(mode==="auto"){ html.setAttribute("data-theme","auto"); }
  else if(mode==="light"){ html.setAttribute("data-theme","light"); }
  else{ html.setAttribute("data-theme","dark"); }
  localStorage.setItem("themeMode",mode);
  $("#themeBtn").textContent = "Theme: " + mode[0].toUpperCase()+mode.slice(1);
}
(function initTheme(){ setTheme(localStorage.getItem("themeMode")||"auto"); })();
$("#themeBtn").addEventListener("click", ()=>{
  const order=["auto","light","dark"];
  const cur=localStorage.getItem("themeMode")||"auto";
  setTheme(order[(order.indexOf(cur)+1)%order.length]);
});

/* APIs (مجانية) */
const CG_GLOBAL   = "https://api.coingecko.com/api/v3/global";
const CG_COIN     = "https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false";
const CG_MKTCHART = "https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=180&interval=daily";
const BCH_HASH    = "https://api.blockchain.info/charts/hash-rate?timespan=60days&format=json&cors=true";
const BCH_DIFF    = "https://api.blockchain.info/charts/difficulty?timespan=60days&format=json&cors=true";
const BCH_ADDR    = "https://api.blockchain.info/charts/n-unique-addresses?timespan=60days&format=json&cors=true";
const BCH_TXV_USD = "https://api.blockchain.info/charts/estimated-transaction-volume-usd?timespan=180days&format=json&cors=true";
const BCH_FEES_USD= "https://api.blockchain.info/charts/transaction-fees-usd?timespan=60days&format=json&cors=true";
const MEMPOOL_FEES = "https://mempool.space/api/v1/fees/recommended";
const MEMPOOL_STATS= "https://mempool.space/api/mempool";

async function getJSON(url){
  const r = await fetch(bust(url), {cache:"no-store"});
  if(!r.ok) throw new Error(`HTTP ${r.status}`);
  return r.json();
}

/* رسم خط السعر */
function drawPriceChart(canvas, series){
  const ctx=canvas.getContext("2d");
  const W=canvas.width, H=canvas.height;
  ctx.clearRect(0,0,W,H);
  if(!series.length) return;
  const xs=series.map(p=>p.t), ys=series.map(p=>p.v);
  const x0=xs[0], x1=xs[xs.length-1];
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const padL=50,padR=10,padT=10,padB=24;
  const X=t=>padL+((t-x0)/(x1-x0))*(W-padL-padR);
  const Y=v=>H-padB-((v-minY)/(maxY-minY))*(H-padT-padB);
  // grid
  ctx.strokeStyle="rgba(128,128,128,.22)"; ctx.lineWidth=1;
  for(let i=0;i<=5;i++){const y=padT+i*(H-padT-padB)/5;ctx.beginPath();ctx.moveTo(padL,y);ctx.lineTo(W-padR,y);ctx.stroke();}
  // line
  ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()||'#4aa8ff';
  ctx.lineWidth=1.7; ctx.beginPath();
  series.forEach((p,i)=>{const x=X(p.t), y=Y(p.v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);});
  ctx.stroke();
  ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()||'#9aa0a6';
  ctx.font="12px Inter, Arial";
  ctx.fillText("$"+(maxY|0).toLocaleString(), 6, Y(maxY)+4);
  ctx.fillText("$"+(minY|0).toLocaleString(), 6, Y(minY)+12);
}

/* بطاقة موّحدة */
function card(title, numberHtml, extraHtml="", tone="", tip=""){
  const cls = tone==="bull"?"ok":tone==="warn"?"warn":tone==="bear"?"bad":"";
  const tipAttr = tip ? ` data-tip="${tip.replace(/"/g,'&quot;')}"` : "";
  return `
  <div class="card ${cls}"${tipAttr}>
    <h3>${title}</h3>
    <div class="centerBox">${numberHtml}</div>
    ${extraHtml}
  </div>`;
}

/* تحويل مجموع الدرجات إلى نص */
function scoreText(x){
  if (x>=2.5) return `Bullish (${x.toFixed(1)})`;
  if (x<=-2.5) return `Bearish (${x.toFixed(1)})`;
  return `Neutral (${x.toFixed(1)})`;
}

/* Gauge SVG (0..100) */
function gaugeSVG(v){
  v=Math.max(0,Math.min(100,Number(v)||0));
  const ang=(v/100)*180, r=70,cx=100,cy=100;
  const arc=(a,b)=>{const ra=a*Math.PI/180, rb=b*Math.PI/180;
    const x1=cx+r*Math.cos(ra), y1=cy+r*Math.sin(ra);
    const x2=cx+r*Math.cos(rb), y2=cy+r*Math.sin(rb);
    return `M ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2}`;};
  const segs=[[0,36,"#ff4d4d"],[36,72,"#ffb84d"],[72,108,"#d9d966"],[108,144,"#88cc66"],[144,180,"#33aa55"]];
  const nx=100+60*Math.cos(ang*Math.PI/180), ny=100+60*Math.sin(ang*Math.PI/180);
  return `<svg viewBox="0 0 200 130" class="gauge" style="transform:rotateX(180deg) rotateY(180deg)">
    <g>${segs.map(s=>`<path d="${arc(s[0],s[1])}" stroke="${s[2]}" stroke-width="12" fill="none"/>`).join("")}</g>
    <line x1="100" y1="100" x2="${nx.toFixed(1)}" y2="${ny.toFixed(1)}" stroke="currentColor" stroke-width="3"/>
    <circle cx="100" cy="100" r="5" fill="currentColor"/>
    <text x="100" y="120" text-anchor="middle" font-size="14" fill="currentColor" font-family="Inter">${Math.round(v)}</text>
  </svg>`;
}

async function main(){
  $("#grid").innerHTML=""; $("#refreshBtn").disabled=true;
  $("#asof").textContent="Updating…"; $("#asofChart").textContent="Updating…";

  const cards=[]; let score=0;

  try{
    const [global, coin, chart] = await Promise.all([
      getJSON(CG_GLOBAL),
      getJSON(CG_COIN),
      getJSON(CG_MKTCHART)
    ]);

    // السعر و الماركِت كاب من /coins/bitcoin
    const priceUSD = coin?.market_data?.current_price?.usd ?? null;
    const btcCap   = coin?.market_data?.market_cap?.usd ?? null;
    const supply   = coin?.market_data?.circulating_supply ?? null;

    // من /global
    const dominance = global?.data?.market_cap_percentage?.btc ?? null;
    const totalM    = global?.data?.total_market_cap?.usd ?? null;
    const vol24     = global?.data?.total_volume?.usd ?? null;
    const altM      = (totalM!=null && btcCap!=null) ? Math.max(0,totalM-btcCap) : null;
    const liqRatio  = (totalM>0 && vol24!=null) ? (vol24/totalM) : null;

    // السعر (مركزي بالنص)
    cards.push(card("BTC Price", `<div class="big">$${compact(priceUSD,true)}</div>`,"","", "Spot price in USD."));

    // Dominance
    let domTone=""; if(dominance>=55) { domTone="bull"; score+=0.4; } else if(dominance<=45){ domTone="warn"; score-=0.2; }
    cards.push(card("BTC Dominance", `<div class="big">${dominance!=null?dominance.toFixed(1):"—"}%</div>`, "", domTone, "BTC market cap share of total crypto."));

    // إجمالي السوق / سوق الألتكوين / حجم 24 ساعة
    cards.push(card("Total Market Cap", `<div class="big">$${compact(totalM,true)}</div>`));
    cards.push(card("Altcoin Market Cap", `<div class="big">$${compact(altM,true)}</div>`));
    cards.push(card("24h Total Volume", `<div class="big">$${compact(vol24,true)}</div>`));
    cards.push(card("Volume / Market Cap", `<div class="big">${liqRatio!=null ? (liqRatio*100).toFixed(2)+"%" : "—"}</div>`));

    // رسم الشارت
    const s=(chart.prices||[]).map(([t,v])=>({t:Math.floor(t/1000), v}));
    drawPriceChart($("#priceChart"), s);
    if(s.length) $("#asofChart").textContent = "Last: " + new Date(s[s.length-1].t*1000).toLocaleDateString();

    // سـتوك-تو-فلو (تقريبي)
    const flowYear = 3.125 * 144 * 365; // بعد هالڤنغ 2024
    const s2f = (supply!=null) ? (supply/flowYear) : null;
    let s2fTone="", s2fMsg="Informational only";
    if(s2f!=null && s2f>100){ s2fTone="bull"; s2fMsg="High scarcity"; score+=0.2; }
    cards.push(card("Stock-to-Flow (approx)",
      `<div class="big">${s2f!=null? s2f.toFixed(1) : "—"}</div>`,
      `<div class="kv"><span>Stock (circulating)</span><span>${supply?compact(supply,true)+" BTC":"—"}</span></div>
       <div class="kv"><span>Flow / year (est.)</span><span>${compact(flowYear,true)} BTC</span></div>
       <div class="muted">${s2fMsg}</div>`, s2fTone, "Approx: current subsidy × blocks/day × 365"));

  }catch(e){
    console.error(e);
    cards.push(card("Core Data", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`,"warn"));
  }

  // Fear & Greed (Gauge)
  try{
    const f = await getJSON("https://api.alternative.me/fng/?limit=2");
    const now=f?.data?.[0];
    if(now){
      const v=Number(now.value);
      let tone=""; if(v<=25){ tone="bear"; score-=.8; } else if(v<=45){ tone="warn"; score-=.4; }
      else if(v>=75){ tone="warn"; score-=.4; } else if(v>=55){ tone="bull"; score+=.2; }
      cards.push(card("Fear & Greed (Gauge)",
        `<div class="big" style="margin-bottom:6px"></div>
         <div style="display:grid;place-items:center">${gaugeSVG(v)}</div>
         <div class="muted" style="text-align:center;margin-top:6px">${now.value_classification} — ${new Date(Number(now.timestamp)*1000).toLocaleDateString()}</div>`,
        "", tone, "Sentiment index (0=extreme fear, 100=extreme greed)."));
    }
  }catch(e){
    cards.push(card("Fear & Greed", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`,"warn"));
  }

  // Hashrate
  try{
    const h=await getJSON(BCH_HASH);
    const pts=h?.values||[]; const last=pts.at(-1), prev=pts.at(-8);
    const latest=last?.y, ch=(latest&&prev)?(latest-prev.y)/prev.y:null;
    let tone=""; if(ch!=null){ if(ch>.05){tone="bull";score+=.3;} else if(ch<-.05){tone="warn";score-=.2;} }
    cards.push(card("Hashrate", `<div class="big">${latest?compact(latest,false):"—"} EH/s</div>`,
      `<div class="kv"><span>~7d Change</span><span>${pct(ch)}</span></div>`, tone, "Estimated network hash rate."));
  }catch(e){ cards.push(card("Hashrate", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`)); }

  // Difficulty
  try{
    const d=await getJSON(BCH_DIFF);
    const pts=d?.values||[]; const last=pts.at(-1), prev=pts.at(-8);
    const latest=last?.y, ch=(latest&&prev)?(latest-prev.y)/prev.y:null;
    let tone=""; if(ch!=null){ if(ch>.03){tone="bull";score+=.2;} else if(ch<-.03){tone="warn";score-=.1;} }
    cards.push(card("Mining Difficulty", `<div class="big">${latest?compact(latest,false):"—"}</div>`,
      `<div class="kv"><span>~7d Change</span><span>${pct(ch)}</span></div>`, tone));
  }catch(e){ cards.push(card("Mining Difficulty", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`)); }

  // Active Addresses
  try{
    const a=await getJSON(BCH_ADDR);
    const pts=a?.values||[]; const last=pts.at(-1), prev=pts.at(-8);
    const latest=last?.y, ch=(latest&&prev)?(latest-prev.y)/prev.y:null;
    let tone=""; if(ch!=null){ if(ch>.05){tone="bull";score+=.3;} else if(ch<-.05){tone="warn";score-=.2;} }
    cards.push(card("Active Addresses", `<div class="big">${latest?compact(latest,false):"—"}</div>`,
      `<div class="kv"><span>~7d Change</span><span>${pct(ch)}</span></div>`, tone));
  }catch(e){ cards.push(card("Active Addresses", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`)); }

  // Fees (USD) + بديل mempool
  try{
    const f=await getJSON(BCH_FEES_USD);
    const pts=f?.values||[]; const last=pts.at(-1), prev=pts.at(-8);
    const feesUSD=last?.y??null; const ch=(feesUSD&&prev)?(feesUSD-prev.y)/prev.y:null;
    let tone=""; if(ch!=null){ if(ch>.25){tone="warn";score-=.2;} else if(ch<-.25){tone="bull";score+=.1;} }
    cards.push(card("Daily Fees (USD)", `<div class="big">$${feesUSD?compact(feesUSD,true):"—"}</div>`,
      `<div class="kv"><span>~7d Change</span><span>${pct(ch)}</span></div>`, tone, "Total daily tx fees in USD."));
  }catch(e){
    try{
      const mf=await getJSON(MEMPOOL_FEES);
      cards.push(card("Current Fees", `<div class="big">${mf.fastestFee} sat/vB</div>`,
        `<div class="kv"><span>Standard</span><span>${mf.halfHourFee} sat/vB</span></div>
         <div class="kv"><span>Economy</span><span>${mf.hourFee} sat/vB</span></div>`));
    }catch(e2){
      cards.push(card("Fees", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`,"warn"));
    }
  }

  // Tx Volume (USD) + NVT (محسوبة محليًا)
  let txUSD=null, btcMCap=null;
  try{
    const t=await getJSON(BCH_TXV_USD);
    const pts=t?.values||[]; const last=pts.at(-1), prev=pts.at(-8);
    txUSD=last?.y??null; const ch=(txUSD&&prev)?(txUSD-prev.y)/prev.y:null;
    let tone=""; if(ch!=null){ if(ch>.05){tone="bull";score+=.2;} else if(ch<-.05){tone="warn";score-=.1;} }
    cards.push(card("Transaction Volume (USD)", `<div class="big">$${txUSD?compact(txUSD,true):"—"}</div>`,
      `<div class="kv"><span>~7d Change</span><span>${pct(ch)}</span></div>`, tone));
  }catch(e){ cards.push(card("Transaction Volume (USD)", `<div class="big">—</div>`, `<div class="muted">Error: ${e.message}</div>`)); }

  try{
    // خذنا ماركت كاب BTC من /coins/bitcoin سابقًا عبر المتغير coin => لكن خارج النطاق الآن، فنسحبه سريعًا:
    const coin = await getJSON(CG_COIN);
    btcMCap = coin?.market_data?.market_cap?.usd ?? null;
  }catch{}
  // NVT = Market Cap / Daily Tx Volume
  const nvt = (btcMCap && txUSD) ? (btcMCap/txUSD) : null;
  let nvtTone="", nvtMsg="Normal range";
  if(nvt!=null){
    if(nvt>150){ nvtTone="warn"; nvtMsg="High valuation"; score-=.2; }
    else if(nvt<50){ nvtTone="bull"; nvtMsg="Low valuation"; score+=.2; }
  }
  cards.push(card("NVT Ratio", `<div class="big">${nvt!=null?nvt.toFixed(1):"—"}</div>`,
    `<div class="kv"><span>BTC Market Cap</span><span>$${btcMCap?compact(btcMCap,true):"—"}</span></div>
     <div class="kv"><span>Tx Volume (USD)</span><span>$${txUSD?compact(txUSD,true):"—"}</span></div>
     <div class="muted">${nvtMsg}</div>`, nvtTone, "NVT = Market Cap ÷ Daily Tx Volume"));

  // Mempool snapshot
  try{
    const m=await getJSON(MEMPOOL_STATS);
    const count=m?.count||0, vsize=m?.vsize||0, totalFees=m?.total_fee||0;
    let tone=""; if(count>50000){ tone="warn"; score-=.2; } else if(count<5000){ tone="bull"; score+=.1; }
    cards.push(card("Mempool Status", `<div class="big">${compact(count,false)} TXs</div>`,
      `<div class="kv"><span>Size</span><span>${(vsize/1e6).toFixed(1)} vMB</span></div>
       <div class="kv"><span>Total Fees</span><span>${(totalFees/1e8).toFixed(2)} BTC</span></div>`, tone));
  }catch(e){}

  // إخراج
  $("#grid").innerHTML = cards.join("");
  $("#marketScore").textContent = "Market Score: " + scoreText(score);
  $("#asof").textContent = "Last updated: " + new Date().toLocaleString();
  $("#refreshBtn").disabled=false;
}

/* أزرار التحكم */
$("#toggleChartBtn").addEventListener("click", ()=>{
  const box=$("#chartBox");
  if(box.style.display==="none"){ box.style.display="block"; $("#toggleChartBtn").textContent="Hide chart"; }
  else { box.style.display="none"; $("#toggleChartBtn").textContent="Show chart"; }
});
$("#refreshBtn").addEventListener("click", main);

/* تحميل أولي */
main();
</script>
</body>
</html>
